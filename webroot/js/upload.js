'use strict';var IconicWebsiteImages=function(){'use strict';var b=this;this.is_initialized=!1,this.is_updated=!0,this.$modal=!1,this.$image_container=!1,this.$pagination_container=!1,this.$total_images_counter=!1,this.$choose_image_btn=!1,this.$remove_image_btn=!1,this.$progress_bar=!1,this.$loading_img=!1,this.pagination={initialized:!1,page:1,total:0,limit:0,total_page:0,keyword:'',day:0,month:0,year:0},this.onChoose=function(c){console.log(c)},this.select_multiple=!1,this.eventListeners=[],this.image_list=[],this.selected_images=[],this.options={allowedFileTypes:['image/png','image/jpeg','image/gif'],maxSizeInMb:10};var a=this;this.isInitialized=function(){return b.is_initialized},this.init=function(){b.is_initialized=!0,$('body').append(b.getModalTemplate()),b.$modal=$('#pah-website-images'),b.$image_container=b.$modal.find('.images-container'),b.$pagination_container=b.$modal.find('ul.pagination'),b.$total_images_counter=b.$modal.find('.total-images-counter'),b.$choose_image_btn=b.$modal.find('.choose-image-btn'),b.$progress_bar=b.$modal.find('.progress-bar'),b.$loading_img=b.$modal.find('.loading-img'),b.$remove_image_btn=b.$modal.find('.remove-image-btn'),b.bindModalEvents()},this.addEventListener=function(c,d){var f={};f.type=c,f.eventHandler=d,b.eventListeners.push(f)},this.on=function(c,d){b.addEventListener(c,d)},this.dispatchEvent=function(c){for(var d=0;d<b.eventListeners.length;d++)c.type===b.eventListeners[d].type&&b.eventListeners[d].eventHandler(c)},this.bindModalEvents=function(){b.$modal.on('click','.open-explorer-btn',function(){a.$modal.find('.image-file-input').click()}),b.$modal.on('show.bs.modal',function(){a.clearAllSelection()}),b.$modal.on('change','.image-file-input',function(){var c=$(this),d=c[0].files;if(0<d.length){if(!a.isValidFileType(d))return alert('Invalid file type!'),void c.val(null);if(!a.isValidFileSize(d))return alert('Invalid file size'),void c.val(null);a.doUpload(d)}}),b.$modal.on('click','#library-tab > a',function(){(!a.isInitialized()||a.isUpdated())&&a.reloadImageList()}),b.$modal.on('click','.image-wrapper',function(){for(var d=$(this),f=parseInt(d.data('id')),g=0;g<a.selected_images.length;g++)if(parseInt(a.selected_images[g].id)===f)return a.selected_images.splice(g,1),a.dispatchEvent({type:'selectionChange',modal:a}),void a.unSelectImage(d);for(var h=0;h<a.image_list.length;h++)if(parseInt(a.image_list[h].id)===f)return a.clearAllSelection(!1),a.selected_images.push(a.image_list[h]),a.selectImage(d),void a.dispatchEvent({type:'selectionChange',modal:a})}),b.$pagination_container.on('click','a',function(){var d=$(this),f=d.closest('li');f.hasClass('active')||(a.pagination.page=parseInt(d.data('page')),a.$pagination_container.find('li').removeClass('active'),f.addClass('active'),a.reloadImageList())}),b.$modal.on('click','.submit-search',function(){a.pagination.day=parseInt($('#search_day').find(':selected').val()),a.pagination.month=parseInt($('#search_month').find(':selected').val()),a.pagination.year=parseInt($('#search_year').find(':selected').val()),a.pagination.keyword=$('#search_keyword').val(),a.is_updated=!0,a.reloadImageList()}),b.$modal.on('keyup','#search_keyword',function(c){13===c.keyCode&&a.$modal.find('.submit-search').click()}),b.on('selectionChange',function(){0===a.selected_images.length?(a.$choose_image_btn.attr('disabled','disabled'),a.$remove_image_btn.attr('disabled','disabled')):(a.$choose_image_btn.removeAttr('disabled','disabled'),a.$remove_image_btn.removeAttr('disabled','disabled'))}),b.$choose_image_btn.on('click',function(){'function'==typeof a.onChoose&&(a.$modal.modal('hide'),a.onChoose(a.selected_images[0]))}),b.$remove_image_btn.on('click',function(){if(a.selected_images[0]&&confirm('Are you sure to delete this image?')){var d=a.selected_images[0].id;$.ajax({url:'/pah-admin/website-images/remove/'+d,type:'post',data:{_csrfToken:$('meta[name=_csrfToken]').attr('content')},success:function success(){a.reloadImageList()},error:function error(){}})}}),a.setUpTimeFilter()},this.setUpTimeFilter=function(){b.setUpYear(),b.setUpMonth(),b.setUpDay(),a.$modal.find('#search_year').on('change',b.setUpMonth),a.$modal.find('#search_month').on('change',b.setUpDay)},this.setUpYear=function(){for(var c=new Date,f=c.getFullYear()+1,g=f;2007<g;g--){}a.$modal.find('#search_year').html(d)},this.setUpMonth=function(){var c=parseInt($('#search_year').find(':selected').val()),d='<option value="">- Month -</option>';if(c)for(var f=1;12>=f;f++)d+='<option value="'+f+'">'+f+'</option>';a.$modal.find('#search_month').html(d).change()},this.setUpDay=function(){var c=parseInt($('#search_month').find(':selected').val()),d='<option value="">- Day -</option>';if(c)for(var f=parseInt($('#search_year').find(':selected').val()),g=new Date(f,c,0),h=g.getDate(),j=1;j<=h;j++)d+='<option value="'+j+'">'+j+'</option>';a.$modal.find('#search_day').html(d)},this.clearAllSelection=function(){var c=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0;a.$modal.find('.image-wrapper').removeClass('selected'),a.selected_images=[],c&&a.dispatchEvent({type:'selectionChange',modal:a})},this.selectImage=function(c){c.addClass('selected')},this.unSelectImage=function(c){c.removeClass('selected')},this.isUpdated=function(){return b.is_updated},this.setUpdated=function(c){b.is_updated=!!c},this.reloadImageList=function(){var c=0<arguments.length&&arguments[0]!==void 0&&arguments[0];c&&(a.pagination.page=1),NProgress.start(),$.ajax({url:'/pah-admin/website-images/list',type:'POST',data:{_csrfToken:$('meta[name=_csrfToken]').attr('content'),page:a.pagination.page,limit:a.pagination.limit,keyword:a.pagination.keyword,day:a.pagination.day,month:a.pagination.month,year:a.pagination.year},success:function success(d){NProgress.done(),a.image_list=d.data,a.pagination.limit=d.limit,a.pagination.page=d.page,a.pagination.total=d.total,a.drawImageList(),a.updatePaginationList(),a.setUpdated(!1),a.$total_images_counter.html('('+a.pagination.total+')'),a.clearAllSelection()},error:function error(){NProgress.done()}})},this.updatePaginationList=function(){var c=Math.ceil(a.pagination.total/a.pagination.limit);if(c!==a.pagination.total_page){a.pagination.total_page=c;var d='';if(1<c)for(var g,f=0;f<c;f++)g=f+1,d+=g===a.pagination.page?'<li class="active"><a href="#" data-page="'+g+'">'+g+'</a></li>':'<li><a href="#" data-page="'+g+'">'+g+'</a></li>';a.$pagination_container.html(d)}},this.drawImageList=function(){for(var d=0;d<a.image_list.length;d++)'<div class="image-wrapper" data-id="'+a.image_list[d].id+'">   <div class="image-item" style="background-image: url('+a.image_list[d].uri+')"></div>   <div class="content">       <p class="file-name"><strong>'+a.image_list[d].name+a.getFileExtension(a.image_list[d].uri)+'</p></strong>       <p><strong>Created:</strong> '+a.getDatetime(a.image_list[d].created)+'</p>       <p><strong>Size:</strong> '+a.image_list[d].width+'x'+a.image_list[d].height+' px</p>   </div></div>';b.$image_container.html(c)},this.getFileExtension=function(c){return c.substring(c.length-4)},this.getDatetime=function(c){return new Date(c).toLocaleString()},this.doUpload=function(c){function d(h){return f.append('image',h),f.append('_csrfToken',$('meta[name=_csrfToken]').attr('content')),$.ajax({url:'/pah-admin/website-images/do-upload',data:f,processData:!1,contentType:!1,type:'POST',success:function success(){var k=parseInt(100*((g+1)/c.length));a.$progress_bar.css('width',k+'%'),a.$progress_bar.html(k+'%'),g<c.length-1?(g++,d(c[g])):(a.$loading_img.hide(),a.setUpdated(!0),a.openLibraryTab(),a.$progress_bar.hide())},error:function error(){alert('Error while uploading image!')}})}var f=new FormData,g=0;d(c[g]),a.$progress_bar.css('width','0%'),a.$progress_bar.html('0%'),a.$progress_bar.show(),a.$loading_img.show()},this.isValidFileType=function(c){if(a.options.allowedFileTypes===void 0)return!0;if(0<c.length){for(var f,d=0;d<c.length;d++)if(f=c[d],0>a.options.allowedFileTypes.indexOf(f.type))return!1;}else return!1;return!0},this.isValidFileSize=function(c){if(a.options.maxSizeInMb===void 0)return!0;if(0<c.length){for(var f,d=0;d<c.length;d++)if(f=c[d],f.size/1024/1024>a.options.maxSizeInMb)return!1;}else return!1;return!0},this.openLibraryTab=function(){b.$modal.find('#library-tab > a').click()},this.open=function(){a.isInitialized()||b.init(),b.$modal.modal('show')},this.getModalTemplate=function(){return'<div id="pah-website-images" class="modal fade images-modal" tabindex="-1" role="dialog">\n   <div class="modal-dialog" role="document">\n       <div class="modal-content" style="border-radius: 0;">\n           <div class="modal-body">\n               <button type="button" class="close close-modal-btn" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n               <div class="clearfix"></div>\n               <div>\n                   <ul class="nav nav-tabs" role="tablist">\n                       <li role="presentation" class="active">\n                           <a href="#home" aria-controls="home" role="tab" data-toggle="tab">\n                               <i class="fa fa-plus" aria-hidden="true"></i> Upload new image\n                           </a>\n                       </li>\n                       <li id="library-tab" role="presentation">\n                           <a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">\n                               <i class="fa fa-picture-o" aria-hidden="true"></i> Library\n                               <span class="total-images-counter"></span> \n                           </a>\n                       </li>\n                   </ul>\n                   <div class="tab-content">\n                       <div role="tabpanel" class="tab-pane text-center active" id="home" style="padding: 50px 0;">\n                           <button type="button" class="btn btn-default btn-lg open-explorer-btn">Select image to upload</button>\n                           <input type="file" class="hidden image-file-input" name="files[]" multiple>\n                           <br/>\n                           <small>Max size: 10MB. Format: JPG, GIF, PNG</small>\n                           <div class="clearfix"></div>\n                           <div class="text-center"><img style="display: none" class="loading-img" src="/images/loading/loading.gif" width="100" /></div>\n                           <div class="progress" style="margin-top: 5px">\n                               <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: 60%; display: none"></div>\n                           </div>\n                       </div>\n                       <div role="tabpanel" class="tab-pane" id="profile">\n                           <div class="search-input-group">\n                               <select id="search_year" type="text" class="form-control"></select>\n                               <select id="search_month" type="text" class="form-control"></select>\n                               <select id="search_day" type="text" class="form-control"></select>\n                               <input maxlength="255" placeholder="Keyword" id="search_keyword" type="text" class="form-control">\n                               <button type="button" class="form-control btn btn-primary submit-search">Search</button>\n                           </div>\n                           <ul class="pagination"></ul>\n                           <div class="clearfix"></div>\n                           <div class="images-container"></div>\n                       </div>\n                   </div>\n                   <div class="clearfix"></div>\n                   <div class="footer-buttons">                       <button type="button" class="btn btn-danger remove-image-btn"><i class="fa fa-trash" aria-hidden="true"></i> Remove</button>\n                       <button type="button" class="btn btn-default pull-right" data-dismiss="modal">Close</button>\n                       <button type="button" style="margin-right: 10px;" class="btn btn-primary pull-right choose-image-btn">Choose image</button>\n                       <div class="clearfix"></div>                   </div>\n               </div>\n           </div>\n       </div>\n   </div>\n</div>'}};
